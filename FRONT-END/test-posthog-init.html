<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test PostHog Configuration</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
    }
    .status {
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
    }
    .success {
      background-color: #d4edda;
      color: #155724;
    }
    .error {
      background-color: #f8d7da;
      color: #721c24;
    }
    .info {
      background-color: #d1ecf1;
      color: #0c5460;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background-color: #0056b3;
    }
    .logs {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #007bff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Test Configuration PostHog</h1>

    <div id="status"></div>

    <div>
      <h2>Actions de test</h2>
      <button onclick="testInit()">1. Tester l'initialisation</button>
      <button onclick="testCapture()">2. Capturer un √©v√©nement test</button>
      <button onclick="testIdentify()">3. Identifier un utilisateur test</button>
      <button onclick="checkConfig()">4. V√©rifier la config</button>
    </div>

    <div class="logs" id="logs"></div>
  </div>

  <!-- Charger PostHog -->
  <script src="posthog.min.js"></script>

  <script>
    const logs = [];

    function addLog(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      logs.push({ timestamp, message, type });
      updateLogs();
    }

    function updateLogs() {
      const logsDiv = document.getElementById('logs');
      logsDiv.innerHTML = '<h3>üìã Logs</h3>' + logs.map(log =>
        `<div class="log-entry">[${log.timestamp}] ${log.message}</div>`
      ).join('');
    }

    function updateStatus(message, type) {
      const statusDiv = document.getElementById('status');
      statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    function testInit() {
      try {
        addLog('üîÑ Tentative d\'initialisation de PostHog...');

        if (typeof posthog === 'undefined') {
          updateStatus('‚ùå PostHog n\'est pas charg√© ! V√©rifiez que posthog.min.js est pr√©sent.', 'error');
          addLog('‚ùå PostHog non disponible (typeof posthog === undefined)', 'error');
          return;
        }

        addLog('‚úÖ PostHog est charg√© (biblioth√®que disponible)');

        // Initialiser PostHog
        posthog.init('phc_Igj1h8n3Ap7uuJNxZ5cVgsoqpx8kC9hALpPMyYWO0TQ', {
          api_host: 'https://eu.i.posthog.com',
          person_profiles: 'always',
          autocapture: false,
          disable_session_recording: true,
          loaded: (ph) => {
            const distinctId = ph.get_distinct_id();
            updateStatus(`‚úÖ PostHog initialis√© avec succ√®s ! Distinct ID: ${distinctId}`, 'success');
            addLog(`‚úÖ PostHog initialis√© - Distinct ID: ${distinctId}`);
            addLog(`üìç API Host: https://eu.i.posthog.com`);
            addLog(`üîë API Key: phc_Igj1h...YWO0TQ`);
          }
        });

        addLog('‚è≥ Initialisation en cours...');

      } catch (error) {
        updateStatus(`‚ùå Erreur lors de l'initialisation : ${error.message}`, 'error');
        addLog(`‚ùå Erreur: ${error.message}`, 'error');
      }
    }

    function testCapture() {
      try {
        if (typeof posthog === 'undefined' || !posthog.__loaded) {
          updateStatus('‚ö†Ô∏è PostHog n\'est pas encore initialis√©. Cliquez d\'abord sur "Tester l\'initialisation"', 'error');
          return;
        }

        addLog('üì§ Envoi d\'un √©v√©nement test...');

        posthog.capture('test_event', {
          test_property: 'test_value',
          timestamp: new Date().toISOString(),
          source: 'test_page'
        });

        updateStatus('‚úÖ √âv√©nement "test_event" envoy√© avec succ√®s !', 'success');
        addLog('‚úÖ √âv√©nement "test_event" captur√© et envoy√©');
        addLog('   Properties: { test_property: "test_value", source: "test_page" }');

      } catch (error) {
        updateStatus(`‚ùå Erreur lors de la capture : ${error.message}`, 'error');
        addLog(`‚ùå Erreur: ${error.message}`, 'error');
      }
    }

    function testIdentify() {
      try {
        if (typeof posthog === 'undefined' || !posthog.__loaded) {
          updateStatus('‚ö†Ô∏è PostHog n\'est pas encore initialis√©. Cliquez d\'abord sur "Tester l\'initialisation"', 'error');
          return;
        }

        const testEmail = 'test@example.com';
        addLog(`üë§ Identification de l'utilisateur : ${testEmail}`);

        posthog.identify(testEmail, {
          email: testEmail,
          name: 'Test User',
          plan: 'TEST',
          test_mode: true
        });

        updateStatus(`‚úÖ Utilisateur "${testEmail}" identifi√© avec succ√®s !`, 'success');
        addLog(`‚úÖ Utilisateur identifi√© : ${testEmail}`);
        addLog('   Properties: { name: "Test User", plan: "TEST" }');

      } catch (error) {
        updateStatus(`‚ùå Erreur lors de l'identification : ${error.message}`, 'error');
        addLog(`‚ùå Erreur: ${error.message}`, 'error');
      }
    }

    function checkConfig() {
      try {
        if (typeof posthog === 'undefined') {
          updateStatus('‚ùå PostHog n\'est pas charg√©', 'error');
          return;
        }

        addLog('üîç V√©rification de la configuration...');

        const config = posthog.config;
        const distinctId = posthog.get_distinct_id ? posthog.get_distinct_id() : 'Non disponible';

        updateStatus(`
          <strong>Configuration PostHog :</strong><br>
          ‚Ä¢ API Host: ${config.api_host || 'Non d√©fini'}<br>
          ‚Ä¢ Distinct ID: ${distinctId}<br>
          ‚Ä¢ Autocapture: ${config.autocapture ? 'Activ√©' : 'D√©sactiv√©'}<br>
          ‚Ä¢ Session Recording: ${config.disable_session_recording ? 'D√©sactiv√©' : 'Activ√©'}<br>
          ‚Ä¢ Persistence: ${config.persistence || 'Non d√©fini'}
        `, 'info');

        addLog(`üìä Configuration PostHog :`);
        addLog(`   - API Host: ${config.api_host}`);
        addLog(`   - Distinct ID: ${distinctId}`);
        addLog(`   - Autocapture: ${config.autocapture ? 'Activ√©' : 'D√©sactiv√©'}`);
        addLog(`   - Session Recording: ${config.disable_session_recording ? 'D√©sactiv√©' : 'Activ√©'}`);

      } catch (error) {
        updateStatus(`‚ùå Erreur lors de la v√©rification : ${error.message}`, 'error');
        addLog(`‚ùå Erreur: ${error.message}`, 'error');
      }
    }

    // Message initial
    updateStatus('üëã Bienvenue ! Cliquez sur "Tester l\'initialisation" pour commencer.', 'info');
    addLog('üöÄ Page de test charg√©e');
    addLog('üìå V√©rifiez que posthog.min.js est dans le m√™me r√©pertoire');
  </script>
</body>
</html>
